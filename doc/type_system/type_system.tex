\documentclass[12pt]{article}

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}

\title{Typed Lua Type System}

\author{Andr√© Murbach Maidl}

\begin{document}

\maketitle

\section{Type Language}

\begin{align*}
T ::= \; & Object\\
& i\\
& s\\
& \textbf{nil}\\
& \textbf{false}\\
& \textbf{true}\\
& Any\\
& Number\\
& String\\
& Boolean\\
\end{align*}

\section{Subtyping}

The subtyping relation ($<:$) should be reflexive (\ref{reflexive})
and transitive (\ref{transitive}).

\begin{align}
\label{reflexive}
S \; <: \; S
\end{align}
\begin{align}
\label{transitive}
\frac{S \; <: \; U \;\;\; U\;  <: \; T}{S \; <: \; T}
\end{align}

\subsection{Constants}

\[
i <: Number \; (\textit{S-INT})
\]

\[
s <: String \; (\textit{S-LIT})
\]

\[
\textbf{false} <: Boolean \; (\textit{S-FALSE})
\]

\[
\textbf{true} <: Boolean \; (\textit{S-TRUE})
\]

\subsection{Object (Top)}

\[
T <: Object \; (\textit{S-OBJ})
\]

\section{Typing Rules}

\subsection{Abstract Syntax}

\begin{align*}
v ::= \; & id \; | \; e[e]\\
%funcname ::= \; & \textbf{function} \; \overline{id} \;
%| \; \textbf{method} \; \overline{id}\\
%funcboby ::= \; & ((\overline{id},isvararg),s)\\
funcboby ::= \; & () \; s \; | \; ({...}) \; s \;
| \; (\overline{id}) \; s \; | \; (\overline{id},{...}) \; s\\
s ::= \; & statements\\
%s ::= \; & \textbf{block} \; \overline{s}\\
%| & \; \textbf{ifelse} \; e \; s \; s\\
%| & \; \textbf{while} \; e \; s\\
%| & \; \textbf{fornum} \; id \; e \; e \; e \; s\\
%| & \; \textbf{forgen} \; \overline{id} \; \overline{e} \; s\\
%| & \; \textbf{repeat} \; s \; e\\
%| & \; \textbf{func} \; funcname \; funcbody\\
%| & \; \textbf{localfunc} \; id \; funcbody\\
%| & \; \textbf{label} \; id\\
%| & \; \textbf{goto} \; id\\
%| & \; break\\
%| & \; \textbf{assign} \; \overline{v} \; \overline{e}\\
%| & \; \textbf{localvar} \; \overline{id} \; \overline{e}\\
%| & \; \textbf{ret} \; \overline{e}\\
%| & \; e\\
e ::= \; & \textbf{nil} \; | \; \textbf{false} \; | \; \textbf{true} \;
| \; {...} \; | \; n \; | \; l \; | \; v \;
| \; \textbf{func} \; funcbody \; | \\
& \{(\overline{e},\overline{(e,e)})\} \;
| \; id(e,\overline{e}) \; | \; e(\overline{e}) \;
| \; e \; binop \; e \; | \; unop \; e\\
binop ::= & + | - | \times | \div | \bmod | \otimes | \oplus
  | \not= | = | < | \le | > | \ge | \land | \lor\\
unop ::= & \; \lnot \; | - | \; \#\\
\end{align*}

\subsection{Expressions}

\[
\textbf{nil} : \textbf{nil} \; (\textit{T-NIL})
\]

\[
\textbf{false} : \textbf{false} \; (\textit{T-FALSE})
\]

\[
\textbf{true} : \textbf{true} \; (\textit{T-TRUE})
\]

\[
{...} : TODO \; (\textit{T-VARARG})
\]

\[
n : n \; (\textit{T-NUMBER})
\]

\[
l : l \; (\textit{T-STRING})
\]

\[
\textbf{func} \; funcbody : TODO \; (\textit{T-ANONFUNC})
\]

\[
\{(\overline{e},\overline{(e,e)})\} : TODO \; (\textit{T-TABLECONST})
\]

\[
id(e,\overline{e}) : TODO \; (\textit{T-METHCALL})
\]

\[
e(\overline{e}) : TODO \; (\textit{T-FUNCCALL})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number}
     {e_{1} + e_{2} : Number} \; (\textit{T-ADDNUM})
\]

\[
\frac{e_{1}:Any \;\;\; e_{2}:Any}
     {e_{1} + e_{2} : Any} \; (\textit{T-ADDANY})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number}
     {e_{1} - e_{2} : Number} \; (\textit{T-SUBNUM})
\]

\[
\frac{e_{1}:Any \;\;\; e_{2}:Any}
     {e_{1} - e_{2} : Any} \; (\textit{T-SUBANY})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number}
     {e_{1} \times e_{2} : Number} \; (\textit{T-MULNUM})
\]

\[
\frac{e_{1}:Any \;\;\; e_{2}:Any}
     {e_{1} \times e_{2} : Any} \; (\textit{T-MULANY})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number}
     {e_{1} \div e_{2} : Number} \; (\textit{T-DIVNUM})
\]

\[
\frac{e_{1}:Any \;\;\; e_{2}:Any}
     {e_{1} \div e_{2} : Any} \; (\textit{T-DIVANY})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number}
     {e_{1} \bmod e_{2} : Number} \; (\textit{T-MODNUM})
\]

\[
\frac{e_{1}:Any \;\;\; e_{2}:Any}
     {e_{1} \bmod e_{2} : Any} \; (\textit{T-MODANY})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number}
     {e_{1} \otimes e_{2} : Number} \; (\textit{T-POWNUM})
\]

\[
\frac{e_{1}:Any \;\;\; e_{2}:Any}
     {e_{1} \otimes e_{2} : Any} \; (\textit{T-POWANY})
\]

\[
\frac{e_{1}:String \;\;\; e_{2}:String}
     {e_{1} \oplus e_{2} : String} \; (\textit{T-CONCATSTR})
\]

\[
\frac{e_{1}:Any \;\;\; e_{2}:Any}
     {e_{1} \oplus e_{2} : Any} \; (\textit{T-CONCATANY})
\]

\[
\frac{e_{1}:T_{1} \;\;\; e_{2}:T_{2}}
     {e_{1} \not= e_{2} : Boolean} \; (\textit{T-NE})
\]

\[
\frac{e_{1}:T_{1} \;\;\; e_{2}:T_{2}}
     {e_{1} = e_{2} : Boolean} \; (\textit{T-EQ})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number}
     {e_{1} < e_{2} : Boolean} \; (\textit{T-LTNUM})
\]

\[
\frac{e_{1}:String \;\;\; e_{2}:String}
     {e_{1} < e_{2} : Boolean} \; (\textit{T-LTSTR})
\]

\[
\frac{e_{1}:Any \;\;\; e_{2}:Any}
     {e_{1} < e_{2} : Boolean} \; (\textit{T-LTANY})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number}
     {e_{1} \le e_{2} : Boolean} \; (\textit{T-LENUM})
\]

\[
\frac{e_{1}:String \;\;\; e_{2}:String}
     {e_{1} \le e_{2} : Boolean} \; (\textit{T-LESTR})
\]

\[
\frac{e_{1}:Any \;\;\; e_{2}:Any}
     {e_{1} \le e_{2} : Boolean} \; (\textit{T-LEANY})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number}
     {e_{1} > e_{2} : Boolean} \; (\textit{T-GTNUM})
\]

\[
\frac{e_{1}:String \;\;\; e_{2}:String}
     {e_{1} > e_{2} : Boolean} \; (\textit{T-GTSTR})
\]

\[
\frac{e_{1}:Any \;\;\; e_{2}:Any}
     {e_{1} > e_{2} : Boolean} \; (\textit{T-GTANY})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number}
     {e_{1} \ge e_{2} : Boolean} \; (\textit{T-GENUM})
\]

\[
\frac{e_{1}:String \;\;\; e_{2}:String}
     {e_{1} \ge e_{2} : Boolean} \; (\textit{T-GESTR})
\]

\[
\frac{e_{1}:Any \;\;\; e_{2}:Any}
     {e_{1} \ge e_{2} : Boolean} \; (\textit{T-GEANY})
\]

\[
\frac{e_{1}:\textbf{nil}}
     {e_{1} \land e_{2} : \textbf{nil}} \; (\textit{T-ANDNIL})
\]

\[
\frac{e_{1}:\textbf{false}}
     {e_{1} \land e_{2} : \textbf{false}} \; (\textit{T-ANDFALSE})
\]

\[
\frac{e_{1}:T_{1} \;\;\; e_{2}:T_{2}}
     {e_{1} \land e_{2} : T_{2}} \; (\textit{T-ANDTRUE})
\]

\[
\frac{e_{1}:\textbf{nil} \;\;\; e_{2}:T}
     {e_{1} \lor e_{2} : T} \; (\textit{T-ORNIL})
\]

\[
\frac{e_{1}:\textbf{false} \;\;\; e_{2}:T}
     {e_{1} \lor e_{2} : T} \; (\textit{T-ORFALSE})
\]

\[
\frac{e_{1}:T}
     {e_{1} \lor e_{2} : T} \; (\textit{T-ORTRUE})
\]

\[
\frac{e : T}
     {\lnot \; e : Boolean} \; (\textit{T-NOT})
\]

\[
\frac{e : Number}
     {- \; e : Number} \; (\textit{T-MINUSNUM})
\]

\[
\frac{e : Any}
     {- \; e : Any} \; (\textit{T-MINUSANY})
\]

\[
\frac{e : String}
     {\# \; e : Number} \; (\textit{T-LEN})
\]

\end{document}
