\documentclass[12pt]{article}

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}

\title{Typed Lua Type System}

\author{Andr√© Murbach Maidl}

\begin{document}

\maketitle

\section{Type Language}

\begin{align*}
T ::= \; & constant \; | \; base\\
constant ::= \; & \textbf{nil} \; | \; \textbf{false} \; | \; \textbf{true} \;
 | \; n \; | \; s\\
base ::= \; & Any \; | \; Boolean \; | \; Number \; | \; String\\
\end{align*}

\section{Subtyping}

The subtyping relation ($<:$) should be reflexive (\ref{reflexive})
and transitive (\ref{transitive}).

\begin{align}
\label{reflexive}
S \; <: \; S
\end{align}
\begin{align}
\label{transitive}
\frac{S \; <: \; U \;\;\; U\;  <: \; T}{S \; <: \; T}
\end{align}

\subsection{Constants}

\[
n <: Number \; (\textit{S-NUM})
\]

\[
s <: String \; (\textit{S-LIT})
\]

\[
\textbf{false} <: Boolean \; (\textit{S-FALSE})
\]

\[
\textbf{true} <: Boolean \; (\textit{S-TRUE})
\]

%\subsection{Object (Top)}
%
%\[
%T <: Object \; (\textit{S-OBJ})
%\]

\section{Typing Rules}

\subsection{Abstract Syntax}

\begin{align*}
v ::= \; & id \; | \; e[e]\\
%funcname ::= \; & \textbf{function} \; \overline{id} \;
%| \; \textbf{method} \; \overline{id}\\
%funcboby ::= \; & ((\overline{id},isvararg),s)\\
funcboby ::= \; & () \; s \; | \; ({...}) \; s \;
| \; (\overline{id}) \; s \; | \; (\overline{id},{...}) \; s\\
s ::= \; & statements\\
%s ::= \; & \textbf{block} \; \overline{s}\\
%| & \; \textbf{ifelse} \; e \; s \; s\\
%| & \; \textbf{while} \; e \; s\\
%| & \; \textbf{fornum} \; id \; e \; e \; e \; s\\
%| & \; \textbf{forgen} \; \overline{id} \; \overline{e} \; s\\
%| & \; \textbf{repeat} \; s \; e\\
%| & \; \textbf{func} \; funcname \; funcbody\\
%| & \; \textbf{localfunc} \; id \; funcbody\\
%| & \; \textbf{label} \; id\\
%| & \; \textbf{goto} \; id\\
%| & \; break\\
%| & \; \textbf{assign} \; \overline{v} \; \overline{e}\\
%| & \; \textbf{localvar} \; \overline{id} \; \overline{e}\\
%| & \; \textbf{ret} \; \overline{e}\\
%| & \; e\\
e ::= \; & \textbf{nil} \; | \; \textbf{false} \; | \; \textbf{true} \;
| \; {...} \; | \; n \; | \; l \; | \; v \;
| \; \textbf{func} \; funcbody \; | \\
& \{(\overline{e},\overline{(e,e)})\} \;
| \; id(e,\overline{e}) \; | \; e(\overline{e}) \;
| \; e \; binop \; e \; | \; unop \; e\\
binop ::= & + | - | \times | \div | \bmod | \otimes | \oplus
  | \not= | = | < | \le | > | \ge | \land | \lor\\
unop ::= & \; \lnot \; | - | \; \#\\
\end{align*}

\subsection{Expressions}

\[
\textbf{nil} : \textbf{nil} \; (\textit{T-NIL})
\]

\[
\textbf{false} : \textbf{false} \; (\textit{T-FALSE})
\]

\[
\textbf{true} : \textbf{true} \; (\textit{T-TRUE})
\]

\[
{...} : TODO \; (\textit{T-VARARG})
\]

\[
n : n \; (\textit{T-NUMBER})
\]

\[
l : l \; (\textit{T-STRING})
\]

\[
\textbf{func} \; funcbody : TODO \; (\textit{T-ANONFUNC})
\]

\[
\{(\overline{e},\overline{(e,e)})\} : TODO \; (\textit{T-TABLECONST})
\]

\[
id(e,\overline{e}) : TODO \; (\textit{T-METHCALL})
\]

\[
e(\overline{e}) : TODO \; (\textit{T-FUNCCALL})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number \;\;\; Number \sim Any}
     {e_{1} + e_{2} : Number} \; (\textit{T-ADD})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number \;\;\; Number \sim Any}
     {e_{1} - e_{2} : Number} \; (\textit{T-SUB})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number \;\;\; Number \sim Any}
     {e_{1} \times e_{2} : Number} \; (\textit{T-MUL})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number \;\;\; Number \sim Any}
     {e_{1} \div e_{2} : Number} \; (\textit{T-DIV})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number \;\;\; Number \sim Any}
     {e_{1} \bmod e_{2} : Number} \; (\textit{T-MOD})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number \;\;\; Number \sim Any}
     {e_{1} \otimes e_{2} : Number} \; (\textit{T-POW})
\]

\[
\frac{e_{1}:String \;\;\; e_{2}:String \;\;\; String \sim Any}
     {e_{1} \oplus e_{2} : String} \; (\textit{T-CONCAT})
\]

\[
\frac{e_{1}:T_{1} \;\;\; e_{2}:T_{2}}
     {e_{1} \not= e_{2} : Boolean} \; (\textit{T-NE})
\]

\[
\frac{e_{1}:T_{1} \;\;\; e_{2}:T_{2}}
     {e_{1} = e_{2} : Boolean} \; (\textit{T-EQ})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number \;\;\; Number \sim Any}
     {e_{1} < e_{2} : Boolean} \; (\textit{T-LT1})
\]

\[
\frac{e_{1}:String \;\;\; e_{2}:String \;\;\; String \sim Any}
     {e_{1} < e_{2} : Boolean} \; (\textit{T-LT2})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number \;\;\; Number \sim Any}
     {e_{1} \le e_{2} : Boolean} \; (\textit{T-LE1})
\]

\[
\frac{e_{1}:String \;\;\; e_{2}:String \;\;\; String \sim Any}
     {e_{1} \le e_{2} : Boolean} \; (\textit{T-LE2})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number \;\;\; Number \sim Any}
     {e_{1} > e_{2} : Boolean} \; (\textit{T-GT1})
\]

\[
\frac{e_{1}:String \;\;\; e_{2}:String \;\;\; String \sim Any}
     {e_{1} > e_{2} : Boolean} \; (\textit{T-GT2})
\]

\[
\frac{e_{1}:Number \;\;\; e_{2}:Number \;\;\; Number \sim Any}
     {e_{1} \ge e_{2} : Boolean} \; (\textit{T-GE1})
\]

\[
\frac{e_{1}:String \;\;\; e_{2}:String \;\;\; String \sim Any}
     {e_{1} \ge e_{2} : Boolean} \; (\textit{T-GE2})
\]

\[
\frac{e_{1}:\textbf{nil}}
     {e_{1} \land e_{2} : \textbf{nil}} \; (\textit{T-AND1})
\]

\[
\frac{e_{1}:\textbf{false}}
     {e_{1} \land e_{2} : \textbf{false}} \; (\textit{T-AND2})
\]

\[
\frac{e_{1}:Boolean \;\;\;
\textbf{typeof}(e_{1}) \not= \textbf{false} \;\;\;
\textbf{typeof}(e_{1}) \not= \textbf{true}}
     {e_{1} \land e_{2} : Any} \; (\textit{T-AND3})
\]

\[
\frac{e_{1}:T_{1} \;\;\; e_{2}:T_{2}}
     {e_{1} \land e_{2} : T_{2}} \; (\textit{T-AND4})
\]

\[
\frac{e_{1}:\textbf{nil} \;\;\; e_{2}:T}
     {e_{1} \lor e_{2} : T} \; (\textit{T-OR1})
\]

\[
\frac{e_{1}:\textbf{false} \;\;\; e_{2}:T}
     {e_{1} \lor e_{2} : T} \; (\textit{T-OR2})
\]

\[
\frac{e_{1}:Boolean \;\;\;
\textbf{typeof}(e_{1}) \not= \textbf{false} \;\;\;
\textbf{typeof}(e_{1}) \not= \textbf{true}}
     {e_{1} \lor e_{2} : Any} \; (\textit{T-OR3})
\]

\[
\frac{e_{1}:T}
     {e_{1} \lor e_{2} : T} \; (\textit{T-OR4})
\]

\[
\frac{e : T}
     {\lnot \; e : Boolean} \; (\textit{T-NOT})
\]

\[
\frac{e : Number \;\;\; Number \sim Any}
     {- \; e : Number} \; (\textit{T-MINUS})
\]

\[
\frac{e : String \;\;\; String \sim Any}
     {\# \; e : Number} \; (\textit{T-LEN})
\]

\end{document}
