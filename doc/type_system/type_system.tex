\documentclass[12pt]{article}

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}

\newcommand{\mylabel}[1]{\; (\textsc{#1})}
\newcommand{\subtype}{<:}
\newcommand{\pipe}{|\;}
\newcommand{\kw}[1]{\mathbf{#1} \;}
\newcommand{\env}{\Gamma}

\title{Typed Lua Type System}

\author{AndrÃ© Murbach Maidl}

\begin{document}

\maketitle

\section{Type Language}

\begin{align*}
T ::= \; & C \pipe B \pipe Object \pipe Any \pipe
S \rightarrow S \pipe T \cup T\\
C ::= \; & \mathbf{nil} \pipe \mathbf{false} \pipe \mathbf{true}
\pipe {<}double{>} \pipe {<}integer{>} \pipe {<}string{>}\\
B ::= \; & Boolean \pipe Number \pipe String\\
S ::= \; & T \pipe {T*} \pipe T \times S\\ 
\end{align*}

\section{Subtyping}

\subsection{Constant types}

\[
C \subtype C
\mylabel{S-CONSTANT}
\]
\[
\mathbf{false} \subtype Boolean
\mylabel{S-FALSE}
\]
\[
\mathbf{true} \subtype Boolean
\mylabel{S-TRUE}
\]
\[
{<}double{>} \subtype Number
\mylabel{S-DOUBLE}
\]
\[
{<}integer{>} \subtype Number
\mylabel{S-INTEGER}
\]
\[
{<}string{>} \subtype Number
\mylabel{S-STRING}
\]

\subsection{Basic types}

\[
B \subtype B
\mylabel{S-BASIC}
\]

\subsection{Object (Top) type}

\[
T \subtype Object
\mylabel{S-OBJECT}
\]

\subsection{Any type}

\[
Any \subtype Any
\mylabel{S-ANY}
\]

\subsection{Function types}

\[
\frac{T_{3} \subtype T_{1} \;\;\; T_{2} \subtype T_{4}}
     {T_{1} \rightarrow T_{2} \subtype T_{3} \rightarrow T_{4}}
\mylabel{S-FUNCTION}
\]

\subsection{Union types}

\[
T_{1} \subtype T_{1} \cup T_{2}
\mylabel{S-UNION1}
\]
\[
T_{2} \subtype T_{1} \cup T_{2}
\mylabel{S-UNION2}
\]
\[
\frac{T_{1} \subtype T \;\;\; T_{2} \subtype T}
     {T_{1} \cup T_{2} \subtype T}
\mylabel{S-UNION3}
\]

\subsection{Product types}

\[
\frac{T_{1} \subtype T_{2} \;\;\; S_{1} \subtype S_{2}}
     {T_{1} \times S_{1} \subtype T_{2} \times S_{2}}
\mylabel{S-PROD}
\]

\subsection{VarArg types}

\[
\frac{T_{1} \subtype T_{2}}
     {T_{1}* \subtype T_{2}*}
\mylabel{VARARG-1}
\]
\[
{T*} \subtype (T \cup Nil) \times {T*}
\mylabel{VARARG-2}
\]

\section{Typing Rules}

\subsection{Abstract Syntax}

\begin{align*}
s ::= \; & \kw{skip} \pipe s_{1} \;;\; s_{2} \; \pipe
\kw{if} e \; \kw{then} s_{1} \; \kw{else} s_{2} \; \pipe\\
& \kw{while} e \; \kw{do} s \; \pipe
\kw{repeat} s \; \kw{until} e \; \pipe\\
& \kw{for} i=e,e,e \; \kw{do} s \; \pipe
\kw{for} \vec{i} \; \kw{in} e(el) \; \kw{do} s \; \pipe\\
& \kw{local} \overrightarrow{i:t} = el \; \kw{in} s \; \pipe
\kw{local} i = f \; \kw{in} s \; \pipe\\
& \kw{::} i \; \kw{::} \pipe \kw{goto} i \; \pipe \kw{break} \pipe
\vec{l} = el \; \pipe \kw{return} el \; \pipe e(el)\\
l ::= \; & i \; \pipe e_{1}[e_{2}]\\
el ::= \; & \kw{nothing} \pipe \vec{e}\\
e ::= \; & k \; \pipe {...} \; \pipe i \; \pipe e_{1}[e_{2}] \; \pipe
f \; \pipe \{\} \; \pipe e_{1} + e_{2} \; \pipe
e_{1} \; {..} \; e_{2} \; \pipe\\
& e_{1} == e_{2} \; \pipe e_{1} < e_{2} \pipe
e_{1} \; \kw{and} e_{2} \; \pipe e_{1} \; \kw{or} e_{2} \; \pipe\\
& \kw{not} e \; | - e \; \pipe \# \; e\\
f ::= \; & \kw{fun} ():t_{r} \; b \; \pipe
\kw{fun} ({...}:t):t_{r} \; b \; \pipe\\
& \kw{fun} (\overrightarrow{i:t}):t_{r} \; b \; \pipe
\kw{fun} (\overrightarrow{i:t},{...}:t):t_{r} \; b\\
b ::= \; & s \;;\; \kw{return} el\\
k ::= \; & \kw{nil} \; \pipe \kw{false} \; \pipe \kw{true} \; \pipe
n \; \pipe w\\
n ::= \; & {<}decimal\;numerals{>}\\
w ::= \; & {<}strings{>}
\end{align*}

\subsection{Typing rules}

\end{document}
