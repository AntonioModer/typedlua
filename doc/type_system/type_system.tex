\documentclass[12pt]{article}

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}

\newcommand{\Any}{\mathbf{any}}
\newcommand{\Nil}{\mathbf{nil}}
\newcommand{\False}{\mathbf{false}}
\newcommand{\True}{\mathbf{true}}
\newcommand{\Boolean}{\mathbf{boolean}}
\newcommand{\Number}{\mathbf{number}}
\newcommand{\String}{\mathbf{string}}
\newcommand{\Void}{\mathbf{void}}

\newcommand{\mylabel}[1]{\; (\textsc{#1})}
\newcommand{\subtype}{<:}

\def\dstart{\hbox to \hsize{\vrule depth 4pt\hrulefill\vrule depth 4pt}}
\def\dend{\hbox to \hsize{\vrule height 4pt\hrulefill\vrule height 4pt}}

\title{Typed Lua Type System}

\author{AndrÃ© Murbach Maidl}

\begin{document}

\maketitle

\section{Type Language}

\textbf{Type Language}\\
\dstart
$$
\begin{array}{rlr}
T ::= & & \textit{first-class types}\\
& \;\; L & \textit{literal types}\\
& | \; B & \textit{base types}\\
& | \; \Any & \textit{dynamic type}\\
& | \; T \cup T & \textit{union type}\\
%& | \; S \rightarrow S & \textit{function type}\\
%& | \; \{T:T, ..., T:T\} & \textit{table type}\\
%& | \; X & \textit{type variable}\\
%& | \; \mu X.T & \textit{recursive type}\\
L ::= & \Nil \; | \; \False \; | \; \True \; | \;
  {<}{\it number}{>} \; | \; {<}{\it string}{>} & \\
B ::= & \Boolean \; | \; \Number \; | \; \String & \\
%S ::= & \Void \; | \; V & \textit{second-class types}\\
%V ::= & \;\; T & \\
%& | \; T* & \textit{vararg type}\\
%& | \; T \times V & \textit{tuple type}
\end{array}
$$
\dend

\section{Subtyping}

\subsection{Literal types}

\[
L \subtype L
\mylabel{S-LITERAL}
\]

\[
\False \subtype \Boolean
\mylabel{S-FALSE}
\]

\[
\True \subtype \Boolean
\mylabel{S-TRUE}
\]

\[
{<}{\it number}{>} \subtype \Number
\mylabel{S-NUMBER}
\]

\[
{<}{\it string}{>} \subtype \String
\mylabel{S-STRING}
\]

\subsection{Base types}

\[
B \subtype B
\mylabel{S-BASE}
\]

\subsection{Dynamic type}

\[
\Any \subtype \Any
\mylabel{S-ANY}
\]

\subsection{Union type}

\[
\frac{T_{1} \subtype T \;\;\; T_{2} \subtype T}
     {T_{1} \cup T_{2} \subtype T}
\mylabel{S-UNION1}
\]

\[
\frac{T \subtype T_{1}}
     {T \subtype T_{1} \cup T_{2}}
\mylabel{S-UNION2}
\]

\[
\frac{T \subtype T_{2}}
     {T \subtype T_{1} \cup T_{2}}
\mylabel{S-UNION3}
\]

\section{Consistent-Subtyping}

\subsection{Literal types}

\[
L \lesssim L
\mylabel{C-LITERAL}
\]

\[
\False \lesssim \Boolean
\mylabel{C-FALSE}
\]

\[
\True \lesssim \Boolean
\mylabel{C-TRUE}
\]

\[
{<}{\it number}{>} \lesssim \Number
\mylabel{C-NUMBER}
\]

\[
{<}{\it string}{>} \lesssim \String
\mylabel{C-STRING}
\]

\subsection{Base types}

\[
B \lesssim B
\mylabel{C-BASE}
\]

\subsection{Dynamic type}

\[
T \lesssim \Any
\mylabel{C-ANY1}
\]

\[
\Any \lesssim T
\mylabel{C-ANY2}
\]

\subsection{Union type}

\[
\frac{T_{1} \lesssim T \;\;\; T_{2} \lesssim T}
     {T_{1} \cup T_{2} \lesssim T}
\mylabel{C-UNION1}
\]

\[
\frac{T \lesssim T_{1}}
     {T \lesssim T_{1} \cup T_{2}}
\mylabel{C-UNION2}
\]

\[
\frac{T \lesssim T_{2}}
     {T \lesssim T_{1} \cup T_{2}}
\mylabel{C-UNION3}
\]

\section{Typing Rules}

\subsection{Abstract Syntax}

\textbf{Abstract Syntax}\\
\dstart
$$
\begin{array}{rl}
s ::= & \;\; \mathbf{skip} \; | \;
s_{1} \; ; \; s_{2} \; | \;
\vec{l} = \vec{e}  \; | \;
\mathbf{while} \; e \; \mathbf{do} \; s \; | \;
\mathbf{if} \; e \; \mathbf{then} \; s_{1} \; \mathbf{else} \; s_{2} \\
& | \; \mathbf{for} \; i = e_{1},e_{2},e_{3} \; \mathbf{do} \; s \; | \;
\mathbf{for} \; \vec{i}{:}\vec{t} \; \mathbf{in} \; \vec{e} \; \mathbf{do} \; s \; | \;
\mathbf{local} \; \vec{i}{:}\vec{t} = \vec{e} \; \mathbf{in} \; s \\
& | \; \mathbf{rec} \; i{:}t = f \; \mathbf{in} \; s \; | \;
\mathbf{goto} \; i \; | \;
{::} \; i \; {::} \; | \;
\mathbf{return} \; \vec{e} \; | \;
\mathbf{break} \\
& | \; e_{1}(\vec{e_{2}})\\
e ::= & \;\; \mathbf{nil} \; | \;
{...} \; | \;
\mathbf{true} \; | \;
\mathbf{false} \; | \;
{<}{\it number}{>} \; | \;
{<}{\it string}{>} \; | \;
f \; | \;
\{ \; \vec{c} \; \} \\
& | \; e_{1} + e_{2} \; | \;
e_{1} \; {..} \; e_{2} \; | \;
e_{1} == e_{2} \; | \;
e_{1} < e_{2} \; | \;
e_{1} \le e_{2} \\
& | \; e_{1} \; \mathbf{and} \; e_{2} \; | \;
e_{1} \; \mathbf{or} \; e_{2} \; | \;
\mathbf{not} \; e \; | \;
- e \; | \;
\# \; e \; | \;
e_{1}(\vec{e_{2}}) \; | \;
l \\
l ::= & \; i \; | \;
e_{1}[e_{2}]\\
f ::= & \; \mathbf{fun} \; (){:}t \; b \; | \;
\mathbf{fun} \; ({...}{:}t_{1}){:}t_{2} \; b \; | \;
\mathbf{fun} \; (\vec{i}{:}\vec{t_{1}}){:}t_{2} \; b \; | \;
\mathbf{fun} \; (\vec{i}{:}\vec{t_{1}},{...}{:}t_{2}){:}t_{3} \; b\\
c ::= & \; e_{1} = e_{2} \; | \;
e\\
b ::= & \; s \; ; \; \mathbf{return} \; \vec{e}
\end{array}
$$
\dend

\subsection{Typing rules}

\end{document}
