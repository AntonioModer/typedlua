This appendix presents the complete set of typing rules of Typed Lua.
\\

\mylabel{T-SKIP}
\[
\env \vdash \mathbf{skip}
\]

\mylabel{T-SEQ}
\[
\dfrac{\env \vdash s_{1} \;\;\;
       \env \vdash s_{2}}
      {\env \vdash s_{1} \; ; \; s_{2}}
\]

\mylabel{T-ASSIGNMENT}
\[
\dfrac{\env \vdash \vec{l}:s_{1} \;\;\;
       \env \vdash \vec{e}:s_{2} \;\;\;
       s_{2} \lesssim s_{1}}
      {\env \vdash \vec{l} = \vec{e}}
\]

\mylabel{T-WHILE}
\[
\dfrac{\env \vdash e:t \;\;\;
       \env \vdash s}
      {\env \vdash \mathbf{while} \; e \; \mathbf{do} \; s}
\]

\mylabel{T-IF}
\[
\dfrac{\env \vdash e:t \;\;\;
       \env \vdash s_{1} \;\;\;
       \env \vdash s_{2}}
      {\env \vdash \mathbf{if} \; e \; \mathbf{then} \; s_{1} \; \mathbf{else} \; s_{2}}
\]

\mylabel{T-LOCAL}
\[
\dfrac{\env \vdash \vec{e}:s \;\;\;
       s \lesssim \vec{t} \;\;\;
       \env[\vec{n} \mapsto \vec{t}] \vdash s}
      {\env \vdash \mathbf{local} \; \vec{n{:}t} = \vec{e} \; \mathbf{in} \; s}
\]

\mylabel{T-LOCALREC}
\[
\dfrac{\env[n \mapsto t] \vdash f \;\;\;
       \env[n \mapsto t] \vdash s}
      {\env \vdash \mathbf{rec} \; n{:}t = f \; \mathbf{in} \; s}
\]

\mylabel{T-RETURN}
\[
\dfrac{\env \vdash \vec{e}:s \;\;\;
       \env(\ret) = r \;\;\;
       s \lesssim r}
      {\env \vdash \mathbf{return} \; \vec{e}}
\]

\mylabel{T-EXPLIST1}
\[
\dfrac{|\vec{e}| = 0}
      {\env \vdash \vec{e}:\Nil{*}}
\]

\mylabel{T-EXPLIST2}
\[
\dfrac{|\vec{e}| > 0 \;\;\;
       \env \vdash \vec{e}:t_{1} \times ... \times t_{n}}
      {\env \vdash \vec{e}:t_{1} \times ... \times t_{n} \times \Nil{*}}
\]

\mylabel{T-EXPLIST3}
\[
\dfrac{|\vec{e}| > 0 \;\;\;
       \env \vdash \vec{e}:t_{1} \times ... \times t_{n}{*}}
      {\env \vdash \vec{e}:t_{1} \times ... \times t_{n}{*}}
\]

\mylabel{T-NIL}
\[
\env \vdash \mathbf{nil}:\Nil
\]

\mylabel{T-FALSE}
\[
\env \vdash \mathbf{false}:\False
\]

\mylabel{T-TRUE}
\[
\env \vdash \mathbf{true}:\True
\]

\mylabel{T-NUM}
\[
\env \vdash {\it number}:{\it number}
\]

\mylabel{T-STR}
\[
\env \vdash {\it string}:{\it string}
\]

\mylabel{T-DOTS}
\[
\dfrac{\env({...}) = T}
      {\env \vdash {...}:T{*}}
\]

\mylabel{T-FUNCTION1}
\[
\dfrac{\env[\ret \mapsto r] \vdash s}
      {\env \vdash \mathbf{fun} \; (){:}r \; s:\Value{*} \rightarrow r}
\]

\mylabel{T-FUNCTION2}
\[
\dfrac{\env[{...} \mapsto t, \ret \mapsto r] \vdash s}
      {\env \vdash \mathbf{fun} \; ({...}{:}t){:}r \; s:t{*} \rightarrow r}
\]

\mylabel{T-FUNCTION3}
\[
\dfrac{\env[\vec{n} \mapsto \vec{t}, \ret \mapsto r] \vdash s}
      {\env \vdash \mathbf{fun} \; (\vec{n{:}t}){:}r \; s:\vec{t} \times \Value{*} \rightarrow r}
\]

\mylabel{T-FUNCTION4}
\[
\dfrac{\env[\vec{n} \mapsto \vec{t}, {...} \mapsto t, \ret \mapsto r] \vdash s}
      {\env \vdash \mathbf{fun} \; (\vec{n{:}t},{...}{:}t){:}r \; s: \vec{t} \times t{*} \rightarrow r}
\]

\mylabel{T-FIELD1}
\[
\dfrac{\env \vdash e_{1}:t_{1} \;\;\;
       \env \vdash e_{2}:t_{2} \;\;\;
       t_{1} \subtype \Boolean}
      {\env \vdash [e_{1}] = e_{2}:t_{1}:t_{2}}
\]

\mylabel{T-FIELD2}
\[
\dfrac{\env \vdash e_{1}:t_{1} \;\;\;
       \env \vdash e_{2}:t_{2} \;\;\;
       t_{1} \subtype \Number}
      {\env \vdash [e_{1}] = e_{2}:t_{1}:t_{2}}
\]

\mylabel{T-FIELD3}
\[
\dfrac{\env \vdash e_{1}:t_{1} \;\;\;
       \env \vdash e_{2}:t_{2} \;\;\;
       t_{1} \subtype \String}
      {\env \vdash [e_{1}] = e_{2}:t_{1}:t_{2}}
\]

\mylabel{T-FIELD4}
\[
\dfrac{\env \vdash e_{1}:t_{1} \;\;\;
       \env \vdash e_{2}:t_{2} \;\;\;
       t_{1} \lesssim \Any \;\;\;
       t_{1} \not\subtype \Nil}
      {\env \vdash [e_{1}] = e_{2}:\Any:t_{2}}
\]

\mylabel{T-CONSTRUCTOR}
\[
\dfrac{\env \vdash \vec{c}:\{ f_{i}, ..., f_{n} \}_{u}}
      {\env \vdash \{ \; \vec{c} \; \}:\{ f_{i}, ..., f_{n} \}_{u}}
\]

\mylabel{T-ARITH1}
\[
\dfrac{\env \vdash e_{1}:T_{1} \;\;\;
       \env \vdash e_{2}:T_{2} \;\;\;
       T_{1} \subtype \Number \;\;\;
       T_{2} \subtype \Number}
      {\env \vdash e_{1} + e_{2}:\Number}
\]

\mylabel{T-ARITH2}
\[
\dfrac{\env \vdash e_{1}:\Any \;\;\;
       \env \vdash e_{2}:T}
      {\env \vdash e_{1} + e_{2}:\Any}
\]

\mylabel{T-ARITH3}
\[
\dfrac{\env \vdash e_{1}:T \;\;\;
       \env \vdash e_{2}:\Any}
      {\env \vdash e_{1} + e_{2}:\Any}
\]

\mylabel{T-CONCAT1}
\[
\dfrac{\env \vdash e_{1}:T_{1} \;\;\;
       \env \vdash e_{2}:T_{2} \;\;\;
       T_{1} \subtype \String \;\;\;
       T_{2} \subtype \String}
      {\env \vdash e_{1} \; {..} \; e_{2}:\String}
\]

\mylabel{T-CONCAT2}
\[
\dfrac{\env \vdash e_{1}:\Any \;\;\;
       \env \vdash e_{2}:T}
      {\env \vdash e_{1} \; {..} \; e_{2}:\Any}
\]

\mylabel{T-CONCAT3}
\[
\dfrac{\env \vdash e_{1}:T \;\;\;
       \env \vdash e_{2}:\Any}
      {\env \vdash e_{1} \; {..} \; e_{2}:\Any}
\]

\mylabel{T-EQUAL}
\[
\dfrac{\env \vdash e_{1}:T_{1} \;\;\;
       \env \vdash e_{2}:T_{2}}
      {\env \vdash e_{1} == e_{2}:\Boolean}
\]

\mylabel{T-ORDER1}
\[
\dfrac{\env \vdash e_{1}:T_{1} \;\;\;
       \env \vdash e_{2}:T_{2} \;\;\;
       T_{1} \subtype \Number \;\;\;
       T_{2} \subtype \Number}
      {\env \vdash e_{1} < e_{2}:\Boolean}
\]

\mylabel{T-ORDER2}
\[
\dfrac{\env \vdash e_{1}:T_{1} \;\;\;
       \env \vdash e_{2}:T_{2} \;\;\;
       T_{1} \subtype \String \;\;\;
       T_{2} \subtype \String}
      {\env \vdash e_{1} < e_{2}:\Boolean}
\]

\mylabel{T-ORDER3}
\[
\dfrac{\env \vdash e_{1}:\Any \;\;\;
       \env \vdash e_{2}:T}
      {\env \vdash e_{1} < e_{2}:\Any}
\]

\mylabel{T-ORDER4}
\[
\dfrac{\env \vdash e_{1}:T \;\;\;
       \env \vdash e_{2}:\Any}
      {\env \vdash e_{1} < e_{2}:\Any}
\]

\mylabel{T-AND1}
\[
\dfrac{\env \vdash e_{1}:\Nil \;\;\;
       \env \vdash e_{2}:T}
      {\env \vdash e_{1} \; \mathbf{and} \; e_{2}:\Nil}
\]

\mylabel{T-AND2}
\[
\dfrac{\env \vdash e_{1}:\False \;\;\;
       \env \vdash e_{2}:T}
      {\env \vdash e_{1} \; \mathbf{and} \; e_{2}:\False}
\]

\mylabel{T-AND3}
\[
\dfrac{\env \vdash e_{1}:T_{1} \cup \Nil \;\;\;
       \env \vdash e_{2}:T_{2}}
      {\env \vdash e_{1} \; \mathbf{and} \; e_{2}:\Nil \cup T_{2}}
\]

\mylabel{T-AND4}
\[
\dfrac{\env \vdash e_{1}:T_{1} \cup \False \;\;\;
       \env \vdash e_{2}:T_{2}}
      {\env \vdash e_{1} \; \mathbf{and} \; e_{2}:\False \cup T_{2}}
\]

\mylabel{T-AND5}
\[
\dfrac{\env \vdash e_{1}:T_{1} \;\;\;
       \env \vdash e_{2}:T_{2}}
      {\env \vdash e_{1} \; \mathbf{and} \; e_{2}:T_{1} \cup T_{2}}
\]

\mylabel{T-OR1}
\[
\dfrac{\env \vdash e_{1}:\Nil \;\;\;
       \env \vdash e_{2}:T}
      {\env \vdash e_{1} \; \mathbf{or} \; e_{2}:T}
\]

\mylabel{T-OR2}
\[
\dfrac{\env \vdash e_{1}:\False \;\;\;
       \env \vdash e_{2}:T}
      {\env \vdash e_{1} \; \mathbf{or} \; e_{2}:T}
\]

\mylabel{T-OR3}
\[
\dfrac{\env \vdash e_{1}:T_{1} \cup \Nil \;\;\;
       \env \vdash e_{2}:T_{2}}
      {\env \vdash e_{1} \; \mathbf{or} \; e_{2}:T_{1} \cup T_{2}}
\]

\mylabel{T-OR4}
\[
\dfrac{\env \vdash e_{1}:T_{1} \cup \False \;\;\;
       \env \vdash e_{2}:T_{2}}
      {\env \vdash e_{1} \; \mathbf{or} \; e_{2}:T_{1} \cup T_{2}}
\]

\mylabel{T-OR5}
\[
\dfrac{\env \vdash e_{1}:T_{1} \;\;\;
       \env \vdash e_{2}:T_{2}}
      {\env \vdash e_{1} \; \mathbf{or} \; e_{2}:T_{1} \cup T_{2}}
\]

\mylabel{T-NOT}
\[
\dfrac{\env \vdash e:T}
      {\env \vdash \mathbf{not} \; e:\Boolean}
\]

\mylabel{T-MINUS1}
\[
\dfrac{\env \vdash e:T \;\;\;
       T \subtype \Number}
      {\env \vdash - e:\Number}
\]

\mylabel{T-MINUS2}
\[
\dfrac{\env \vdash e:\Any}
      {\env \vdash - e:\Any}
\]

\mylabel{T-LEN1}
\[
\dfrac{\env \vdash e:T \;\;\;
       T \subtype \String}
      {\env \vdash \# \; e:\Number}
\]

\mylabel{T-LEN2}
\[
\dfrac{\env \vdash e:T \;\;\;
       T \subtype \{\}_{c}}
      {\env \vdash \# \; e:\Number}
\]

\mylabel{T-LEN3}
\[
\dfrac{\env \vdash e:\Any}
      {\env \vdash \# \; e:\Any}
\]

\mylabel{T-APPLY1}
\[
\dfrac{\env \vdash e_{1}:p_{1} \rightarrow r \;\;\;
       \env \vdash \vec{e_{2}}:p_{2} \;\;\;
       p_{2} \lesssim p_{1}}
      {\env \vdash e_{1}(\vec{e_{2}}):r}
\]

\mylabel{T-APPLY2}
\[
\dfrac{\env \vdash e_{1}:\Any \;\;\;
       \env \vdash \vec{e_{2}}:p}
      {\env \vdash e_{1}(\vec{e_{2}}):\Any{*}}
\]

\mylabel{T-INVOKE1}
\[
\dfrac{\env \vdash e_{1}[n]:p_{1} \rightarrow r \;\;\;
       \env \vdash \vec{e_{2}}:p_{2} \;\;\;
       p_{2} \lesssim p_{1}}
      {\env \vdash e_{1}{:}n(\vec{e_{2}}):r}
\]

\mylabel{T-INVOKE2}
\[
\dfrac{\env \vdash e_{1}[n]:\Any \;\;\;
       \env \vdash \vec{e_{2}}:p}
      {\env \vdash e_{1}{:}n(\vec{e_{2}}):\Any{*}}
\]

\mylabel{T-ID}
\[
\dfrac{\env(n) = T}
      {\env \vdash n:T}
\]

\mylabel{T-INDEX1}
\[
\dfrac{\env \vdash e_{1}:\{k_{1}{:}t_{1}, ..., k_{n}{:}t_{n}\} \;\;\;
       \env \vdash e_{2}:t \;\;\;
       \exists i \in 1{..}n \; t \lesssim k_{i}}
      {\env \vdash e_{1}[e_{2}]:t_{i}}
\]

\mylabel{T-INDEX2}
\[
\dfrac{\env \vdash e_{1}:\Any \;\;\;
       \env \vdash e_{2}:t}
      {\env \vdash e_{1}[e_{2}]:\Any}
\]

\mylabel{T-PAREN1}
\[
\dfrac{\env \vdash e:t}
      {\env \vdash (e):t}
\]

\mylabel{T-PAREN2}
\[
\dfrac{\env \vdash e:s}
      {\env \vdash (e):first(s)}
\]

\mylabel{T-CAST}
\[
\dfrac{\env \vdash e:t_{1} \;\;\;
       t_{1} \subtype t}
      {\env \vdash {<}t{>} \; e:t}
\]

\mylabel{T-SELF}
\[
\dfrac{\env \vdash e:\Self \;\;\;
       \env(\Self) = t}
      {\env \vdash e:t}
\]

\mylabel{T-RECURSIVE}
\[
\dfrac{\env \vdash e:\mu x.t}
      {\env \vdash e:t[x \mapsto \mu x.t]}
\]

\mylabel{T-TERNARY}
\[
\dfrac{\env \vdash e_{1}:t_{1} \;\;\;
       \env \vdash e_{2}:t_{2} \;\;\;
       \env \vdash e_{3}:t_{2}}
      {\env \vdash e_{1} \; \mathbf{and} \; e_{2} \; \mathbf{or} \; e_{3}:t_{2}}
\]

